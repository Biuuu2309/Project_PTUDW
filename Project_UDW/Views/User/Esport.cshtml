@{
    ViewData["Title"] = "Esport";
    Layout = null;
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" integrity="sha256-2XFplPlrFClt0bIdPgpz8H7ojnk10H69xRqd9+uTShA=" crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLR0Ff3B4o1RjM3TV7pHIUydm4e4W3F4L8tFVCmwHZ" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container-fluid">
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">STT</th>
                <th scope="col">Khu vuc</th>
                <th scope="col">List team</th>
            </tr>
        </thead>
        <tbody id="esportTableBody">
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        $.ajax({
            type: "GET",
            url: "/api/UserEsport/GetUserKhuVuc",
            dataType: "json",
            success: function (data) {
                var tbody = $('#esportTableBody');
                tbody.empty();
                data.forEach(function (khuvuc, index) {
                    var row = '<tr>' +
                        '<th scope="row">' + (index + 1) + '</th>' +
                        '<td>' +
                        '<h4 id="' + khuvuc.makhuvuc + '">' + khuvuc.makhuvuc + '</h4>' +
                        '<img id="backgroundImagee" src="/Pictures/Positions/' + khuvuc.avakhuvuc + '" />' +
                        '</td>' +
                        '<td id="teamTableBody-' + khuvuc.makhuvuc + '"></td>' +
                        '</tr>';
                    tbody.append(row);
                    fetchTeamDetails(khuvuc.makhuvuc);
                });
            },
            error: function (error) {
                console.error("Error fetching data:", error);
            }
        });
    });

    function fetchTeamDetails(makhuvuc) {
        $.ajax({
            type: "GET",
            url: "/api/UserEsport/GetUserTeamDetail",
            data: { makhuvuc: makhuvuc },
            dataType: "json",
            success: function (data) {
                var td = $('#teamTableBody-' + makhuvuc);
                td.empty();
                data.forEach(function (team) {
                    var card =
                        '<div class="card" style="width: 10rem; display: inline-block; margin: 5px;">' +
                        '<img src="/Pictures/Teams/' + team.avateam + '" class="card-img-top" alt="Team image">' +
                        '<div class="card-body">' +
                        '<h5 class="card-title">' + team.tenteam + '</h5>' +
                        '</div>' +
                        '</div>';
                    td.append(card);
                });
            },
            error: function (error) {
                console.error("Error fetching data:", error);
            }
        });
    }
</script>
